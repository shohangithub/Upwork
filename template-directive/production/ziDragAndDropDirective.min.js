!function(e){var n="application/x-zi",t="application/json",r="Text",a=["move","copy","link"];function i(e,n){return"all"==n?e:e.filter(function(e){return-1!=n.toLowerCase().indexOf(e)})}e.directive("ziTemplateGenerator",["$rootScope",function(e){return{restrict:"E",replace:!0,scope:{data:"="},template:'<div class="span10 offset1">\n      <style>\n          .zi-add-btn,\n          .zi-add-btn:focus,\n          .zi-add-btn:hover,\n          .zi-add-btn::after {\n              border-radius: 0;\n              padding: .5rem 3rem;\n              background-color: #3C3C3C !important;\n              background-image: none;\n              color: #FFFFFF;\n              font: 1rem;\n              font-family: \'Roboto\', sans-serif;\n              border: none;\n          }\n  \n          .zi-remove-btn,\n          .zi-remove-btn:focus,\n          .zi-remove-btn:hover,\n          .zi-remove-btn::after {\n              border-radius: 0;\n              padding: .5rem 2rem;\n              background-color: #FE0015;\n              background-image: none;\n              color: #FFFFFF;\n              border: none;\n          }\n  \n          .row-fluid [class*="span"] {\n              margin-left: 0;\n          }\n  \n          .template-body {\n              padding: 3rem 1rem;\n          }\n  \n          .input-container {\n              margin-top: 15px;\n          }\n  \n          .input-container:not(:last-child) {\n              border-right: 2px solid #6F6F6F;\n          }\n  \n          .template-body .control-label {\n              color: #6F6F6F;\n          }\n  \n          .template-body select {\n              border-radius: 0;\n              background-color: #3C3C3C !important;\n              background-image: none;\n              color: #FFFFFF;\n              font-size: 1rem;\n              font-family: \'Roboto\', sans-serif;\n              border: none;\n              padding-right: 15px;\n          }\n  \n          .template-body input[type="text"] {\n              border-radius: 0px;\n              background-color: #FFFFFF;\n          }\n  \n          .template-body input[type="color"] {\n              -webkit-appearance: none;\n              border: none;\n              width: 0px;\n              height: 0px;\n              opacity: 0;\n          }\n  \n          .template-body input[type="color"]::-webkit-color-swatch-wrapper {\n              padding: 0;\n          }\n  \n          .template-body input[type="color"]::-webkit-color-swatch {\n              border: none;\n          }\n  \n          select,\n          textarea,\n          input[type="text"],\n          input[type="button"] {\n              max-width: -webkit-fill-available !important;\n          }\n      </style>\n      <div class="row">\n          <div class="span3">\n              <button class="btn zi-add-btn" type="button" ng-click="ziAddNewTemplete()">Add</button>\n          </div>\n      </div>\n      <div class="row" zi-list="ziModels.list">\n          <div class="span3 input-container" ng-repeat="item in ziModels.list" zi-draggable="item"\n              zi-moved="ziModels.list.splice($index, 1)" zi-effect-allowed="move" zi-selected="ziModels.selected = item"\n              ng-class="{\'selected\': ziModels.selected === item}">\n              <div class="span* template-body">\n                  <div class="control-group">\n                      <label class="control-label span4">Field</label>\n                      <div class="controls span8">\n                          <select ng-model="item.field">\n                              <option></option>\n                              <option value=\'title\'>Title</option>\n                              <option value=\'description\'>Description</option>\n                              <option value=\'sku\'>Sku</option>\n                          </select>\n                      </div>\n                  </div>\n                  <div class="control-group">\n                      <label class="control-label span4">Bg Color</label>\n                      <div class="controls span8">\n                          <input type="text" ng-model="item.bg_color" ng-click="ziOpenColorPicker($event)" readonly>\n                          <input type="color" class="color-picker" ng-model="item.bg_color">\n                      </div>\n                  </div>\n                  <div class="control-group">\n                      <div class="span7 offset5">\n                          <input class="btn zi-remove-btn" type="button" value="Remove"\n                              ng-click="ziRemoveTemplete(item,$index)" />\n                      </div>\n                  </div>\n              </div>\n          </div>\n      </div>\n  </div>',link:function(e){e.ziModels={selected:null,list:e.data},e.ziAddNewTemplete=function(){try{e.ziModels.list.push({field:null,bg_color:null})}catch(e){throw e}},e.ziRemoveTemplete=function(n,t){try{e.ziModels.list.splice(t,1)}catch(e){throw e}},e.ziOpenColorPicker=function(e){try{var n=e.currentTarget.nextElementSibling;n&&setTimeout(function(){n.click()},50)}catch(e){throw e}},e.$watch("ziModels",function(n){e.modelAsJson=angular.toJson(n.list,!0)},!0)}}}]),e.directive("ziDraggable",["$parse","$timeout",function(e,l){return function(d,c,s){c.attr("draggable","true"),s.ziDisableIf&&d.$watch(s.ziDisableIf,function(e){c.attr("draggable",!e)}),c.on("dragstart",function(p){if(p=p.originalEvent||p,"false"==c.attr("draggable"))return!0;o.isDragging=!0,o.itemType=s.ziType&&d.$eval(s.ziType).toLowerCase(),o.dropEffect="none",o.effectAllowed=s.ziEffectAllowed||a[0],p.dataTransfer.effectAllowed=o.effectAllowed;var f=d.$eval(s.ziDraggable),u=n+(o.itemType?"-"+o.itemType:"");try{p.dataTransfer.setData(u,angular.toJson(f))}catch(e){var g=angular.toJson({item:f,type:o.itemType});try{p.dataTransfer.setData(t,g)}catch(e){var v=i(a,o.effectAllowed);p.dataTransfer.effectAllowed=v[0],p.dataTransfer.setData(r,g)}}if(c.addClass("ziDragging"),l(function(){c.addClass("ziDraggingSource")},0),p._ziHandle&&p.dataTransfer.setDragImage&&p.dataTransfer.setDragImage(c[0],0,0),e(s.ziDragstart)(d,{event:p}),s.ziCallback){var z=e(s.ziCallback);o.callback=function(e){return z(d,e||{})}}p.stopPropagation()}),c.on("dragend",function(n){n=n.originalEvent||n,d.$apply(function(){var t=o.dropEffect;e(s[{copy:"ziCopied",link:"ziLinked",move:"ziMoved",none:"ziCanceled"}[t]])(d,{event:n}),e(s.ziDragend)(d,{event:n,dropEffect:t})}),o.isDragging=!1,o.callback=void 0,c.removeClass("ziDragging"),c.removeClass("ziDraggingSource"),n.stopPropagation(),l(function(){c.removeClass("ziDraggingSource")},0)}),c.on("click",function(n){s.ziSelected&&(n=n.originalEvent||n,d.$apply(function(){e(s.ziSelected)(d,{event:n})}),n.stopPropagation())}),c.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("ziList",["$parse",function(e){return function(l,d,c){var s=function(){var e;return angular.forEach(d.children(),function(n){var t=angular.element(n);t.hasClass("ziPlaceholder")&&(e=t)}),e||angular.element("<li class='ziPlaceholder'></li>")}();s.remove();var p=s[0],f=d[0],u={};function g(e){if(!e)return r;for(var a=0;a<e.length;a++)if(e[a]==r||e[a]==t||e[a].substr(0,n.length)==n)return e[a];return null}function v(e){return o.isDragging?o.itemType||void 0:e==r||e==t?null:e&&e.substr(n.length+1)||void 0}function z(e){return!u.disabled&&(!(!u.externalSources&&!o.isDragging)&&(!u.allowedTypes||null===e||e&&-1!=u.allowedTypes.indexOf(e)))}function b(e,n){var t=a;return n||(t=i(t,e.dataTransfer.effectAllowed)),o.isDragging&&(t=i(t,o.effectAllowed)),c.ziEffectAllowed&&(t=i(t,c.ziEffectAllowed)),t.length?e.ctrlKey&&-1!=t.indexOf("copy")?"copy":e.altKey&&-1!=t.indexOf("link")?"link":t[0]:"none"}function m(){return s.remove(),d.removeClass("ziDragover"),!0}function y(n,t,r,a,i,d){return e(n)(l,{callback:o.callback,dropEffect:r,event:t,external:!o.isDragging,index:void 0!==i?i:h(),item:d||void 0,type:a})}function h(){return Array.prototype.indexOf.call(f.children,p)}d.on("dragenter",function(e){e=e.originalEvent||e;var n=c.ziAllowedTypes&&l.$eval(c.ziAllowedTypes);u={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),disabled:c.ziDisableIf&&l.$eval(c.ziDisableIf),externalSources:c.ziExternalSources&&l.$eval(c.ziExternalSources),horizontal:c.ziHorizontalList&&l.$eval(c.ziHorizontalList)};var t=g(e.dataTransfer.types);if(!t||!z(v(t)))return!0;e.preventDefault()}),d.on("dragover",function(e){var n=g((e=e.originalEvent||e).dataTransfer.types),t=v(n);if(!n||!z(t))return!0;if(p.parentNode!=f&&d.append(s),e.target!=f){for(var a=e.target;a.parentNode!=f&&a.parentNode;)a=a.parentNode;if(a.parentNode==f&&a!=p){var i=a.getBoundingClientRect();if(u.horizontal)var o=e.clientX<i.left+i.width/2;else o=e.clientY<i.top+i.height/2;f.insertBefore(p,o?a:a.nextSibling)}}var l=n==r,h=b(e,l);return"none"==h?m():c.ziDragover&&!y(c.ziDragover,e,h,t)?m():(e.preventDefault(),l||(e.dataTransfer.dropEffect=h),d.addClass("ziDragover"),e.stopPropagation(),!1)}),d.on("drop",function(e){var n=g((e=e.originalEvent||e).dataTransfer.types),a=v(n);if(!n||!z(a))return!0;e.preventDefault();try{var i=JSON.parse(e.dataTransfer.getData(n))}catch(e){return m()}if((n==r||n==t)&&(a=i.type||void 0,i=i.item,!z(a)))return m();var d=n==r,s=b(e,d);if("none"==s)return m();var p=h();return c.ziDrop&&!(i=y(c.ziDrop,e,s,a,p,i))?m():(o.dropEffect=s,d||(e.dataTransfer.dropEffect=s),!0!==i&&l.$apply(function(){l.$eval(c.ziList).splice(p,0,i)}),y(c.ziInserted,e,s,a,p,i),m(),e.stopPropagation(),!1)}),d.on("dragleave",function(e){e=e.originalEvent||e;var n=document.elementFromPoint(e.clientX,e.clientY);f.contains(n)&&!e._ziPhShown?e._ziPhShown=!0:m()})}}]),e.directive("ziNodrag",function(){return function(e,n,t){n.attr("draggable","true"),n.on("dragstart",function(e){(e=e.originalEvent||e)._ziHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){(e=e.originalEvent||e)._ziHandle||e.stopPropagation()})}}),e.directive("ziHandle",function(){return function(e,n,t){n.attr("draggable","true"),n.on("dragstart dragend",function(e){(e=e.originalEvent||e)._ziHandle=!0})}});var o={}}(angular.module("ziDragAndDropModule",[]));